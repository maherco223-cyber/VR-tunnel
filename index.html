<!DOCTYPE html>
<html>
<head>
    <title>Puff VR - مشغل الملفات المحلية</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
        #ui { position: absolute; top: 20px; left: 20px; z-index: 1000; background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px; font-family: sans-serif; }
        button { cursor: pointer; padding: 10px; background: #ff00ff; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="ui">
        <h3>مشغل Puff VR</h3>
        <p>اختر الـ 55 فيديو من جهازك:</p>
        <input type="file" id="fileInput" multiple accept="video/*">
        <br><br>
        <button onclick="enterVR()">ابدأ التجربة في VR</button>
    </div>

    <a-scene>
        <a-assets id="videoAssets"></a-assets>

        <a-sky color="#ffafbd"></a-sky>
        
        <a-entity>
            <a-cylinder radius="20" height="500" open-ended="true" side="double"
                        material="wireframe: true; color: #4facfe; opacity: 0.2"
                        rotation="90 0 0"></a-cylinder>
            <a-cylinder radius="19" height="500" open-ended="true" side="double"
                        material="wireframe: true; color: #9626e2; opacity: 0.3"
                        rotation="90 0 0"></a-cylinder>
        </a-entity>

        <a-entity id="screenContainer"></a-entity>

        <a-entity camera look-controls position="0 1.6 0">
            <a-cursor color="cyan"></a-cursor>
        </a-entity>
    </a-scene>

    <script>
        const fileInput = document.getElementById('fileInput');
        const assets = document.getElementById('videoAssets');
        const container = document.getElementById('screenContainer');

        fileInput.onchange = function(e) {
            const files = Array.from(e.target.files);
            
            files.forEach((file, i) => {
                // تحويل الملف المحلي إلى رابط مؤقت يفهمه المتصفح
                const url = URL.createObjectURL(file);
                
                // إنشاء عنصر الفيديو
                const v = document.createElement('video');
                v.id = `vid${i}`;
                v.src = url;
                v.loop = true;
                v.crossOrigin = "anonymous";
                assets.appendChild(v);

                // إنشاء الشاشة في VR
                const screen = document.createElement('a-video');
                screen.setAttribute('src', `#vid${i}`);
                screen.setAttribute('width', '6');
                screen.setAttribute('height', '3.37');

                // التوزيع الحلزوني
                const angle = i * 0.4;
                const radius = 12;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius + 2;
                const z = -i * 7;

                screen.setAttribute('position', `${x} ${y} ${z}`);
                screen.setAttribute('rotation', `0 ${-angle * 57.3 + 90} 0`);
                container.appendChild(screen);
            });
        };

        function enterVR() {
            document.querySelectorAll('video').forEach(v => v.play());
            document.querySelector('a-scene').enterVR();
            document.getElementById('ui').style.display = 'none';
        }
    </script>
</body>
</html>
